$card-width: 200px;
$card-height: 250px;
$transition-timing: cubic-bezier(0.25, 0.1, 0.25, 1);

.card-container {
  position: absolute;
  cursor: pointer;
  pointer-events: none;
  transition: transform 0.5s $transition-timing, opacity 0.4s ease, width 0.3s $transition-timing, height 0.3s $transition-timing, z-index 0s;
  will-change: transform;
  max-width: 100vw;
  width: var(--width);
  height: var(--height);

  // Disable transition during panning for smooth drag
  &.panning {
    transition: none;
  }

  // When zoomed, show move cursor
  &.fold.open.zoomed {
    cursor: move;
  }

  // Responsive adjustments for viewport width 768px and below
  @media (max-width: 768px) {
    max-width: 90vw;
    // min-width: 80vw;
    max-height: 100vh;
    min-height: 50vw;
    // width: auto;
    height: auto;
    aspect-ratio: var(--aspect-ratio);
  }



  &.hidden {
    opacity: 0;
    pointer-events: none;
  }

  &.active {
    pointer-events: auto;
    z-index: 100 !important;
    .card-inner .card-cover {
      box-shadow:
        0 25px 50px rgba(0, 0, 0, 0.5),
        0 0 60px rgba(255, 255, 255, 0.1);
    }
  }

  &.open {
    pointer-events: auto;
    z-index: 200 !important;
  }

  // Fold card open state
  &.fold {
    transform-style: preserve-3d;

    &.open {
      cursor: grab;

      &.panning {
        cursor: grabbing;
      }

      .card-inner {
        .card-cover {
          transform: rotateY(-180deg);
          box-shadow:
            -10px 10px 30px rgba(0, 0, 0, 0.4),
            0 0 80px rgba(255, 255, 255, 0.15);
        }

        .card-left {
          opacity: 1;
          transform: rotateY(-180deg);
        }

        .card-right {
          opacity: 1;
        }
      }
    }
  }

  // Popup card open state
  &.popup.open {
    cursor: default;

    .card-inner {
      .card-cover {
        transition: transform 0.6s $transition-timing, box-shadow 0.5s ease, opacity 0.3s ease 0.6s;
        transform: rotateX(-90deg) rotateZ(-45deg) translateY(50%) translateZ(-$card-height / 2);
        opacity: 0;
        transform-origin: bottom center;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      }

      .popup-wrapper {
        opacity: 1;
      }

      .popup-content {
        transform: scaleY(1);
      }

      .popup-message {
        opacity: 1;
        transform: translateX(0%);
      }
    }
  }

  // No-open card open state (just zoom, no opening)
  &.no-open.open {
    cursor: default;

    .card-inner {
      .card-cover {
        box-shadow:
          0 25px 50px rgba(0, 0, 0, 0.6),
          0 0 80px rgba(255, 255, 255, 0.15);
      }
    }
  }

  // Fold-down card open state (vertical fold)
  &.fold-down {
    transform-style: preserve-3d;

    &.open {
      cursor: default;

      .card-inner {
        .card-cover {
          transform: rotateX(180deg);
          transform-origin: top center;
          box-shadow:
            0 -10px 30px rgba(0, 0, 0, 0.4),
            0 0 80px rgba(255, 255, 255, 0.15);
        }

        .card-top {
          opacity: 1;
          transform: rotateX(180deg);
        }

        .card-bottom {
          opacity: 1;
        }
      }
    }
  }
}

.card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
}



.card-left {
  position: absolute;
  width: var(--left-width, 100%);
  height: var(--left-height, 100%);
  border-radius: 8px;
  overflow: hidden;
  transition: width 0.5s $transition-timing, height 0.5s $transition-timing, transform .8s $transition-timing .225s, opacity 0.3s ease .225s;

  @media (max-width: 768px) {
    width: auto;
    height: auto;
    aspect-ratio: var(--left-aspect-ratio);
  }

  img {
    width: 100%;
    height: 100%;
    // object-fit: contain;
    pointer-events: none;
    transform: scaleX(-1);
  }
}

.card-right {
  position: absolute;
  width: var(--right-width, 100%);
  height: var(--right-height, 100%);
  backface-visibility: hidden;
  border-radius: 8px;
  overflow: hidden;
  transition: width 0.5s $transition-timing, height 0.5s $transition-timing, opacity 0.5s ease 0.2s;

  @media (max-width: 768px) {
    width: auto;
    height: auto;
    aspect-ratio: var(--right-aspect-ratio);
  }

  img {
    width: 100%;
    height: 100%;
    // object-fit: contain;
    pointer-events: none;
  }
}

.card-cover {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  border-radius: 8px;
  overflow: hidden;

  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
  }
}

.card-cover {
  z-index: 3;
  transform-origin: left center;
  transform: rotateY(0deg);
  transition: transform .8s $transition-timing, box-shadow 0.5s ease;
  box-shadow:
    0 15px 35px rgba(0, 0, 0, 0.4),
    0 0 30px rgba(255, 255, 255, 0.05);

  &::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.15) 0%,
      transparent 50%,
      rgba(0, 0, 0, 0.1) 100%
    );
    pointer-events: none;
  }
}

.card-right {
  z-index: 2;
  opacity: 0;
  box-shadow:
    0 10px 30px rgba(0, 0, 0, 0.3);
}

.card-left {
  z-index: 4;
  transform-origin: left center;
  transform: rotateY(-90deg);
  opacity: 0;

}

.card-top {
  position: absolute;
  width: var(--left-width, 100%);
  height: var(--left-height, 100%);
  border-radius: 8px;
  overflow: hidden;
  z-index: 4;
  transform-origin: top center;
  transform: rotateX(90deg);
  opacity: 0;
  transition: width 0.5s $transition-timing, height 0.5s $transition-timing, transform .8s $transition-timing .225s, opacity 0.3s ease .225s;

  @media (max-width: 768px) {
    width: auto;
    height: auto;
    aspect-ratio: var(--left-aspect-ratio);
  }

  img {
    width: 100%;
    height: 100%;
    // object-fit: contain;
    pointer-events: none;
    transform: scaleY(-1);
  }
}

.card-bottom {
  position: absolute;
  width: var(--right-width, 100%);
  height: var(--right-height, 100%);
  backface-visibility: hidden;
  border-radius: 8px;
  overflow: hidden;
  z-index: 2;
  opacity: 0;
  transition: width 0.5s $transition-timing, height 0.5s $transition-timing, opacity 0.5s ease 0.2s;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);

  @media (max-width: 768px) {
    width: auto;
    height: auto;
    aspect-ratio: var(--right-aspect-ratio);
  }

  img {
    width: 100%;
    height: 100%;
    // object-fit: contain;
    pointer-events: none;
  }
}

.close-button {
  position: absolute;
  top: -40px;
  right: -40px;
  width: 36px;
  height: 36px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  color: #fff;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s ease, transform 0.3s ease;
  backdrop-filter: blur(10px);
  z-index: 101;

  &:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }
}

// Popup card specific styles
.popup-wrapper {
  position: absolute;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  top: 100%;
  left: 0;
  transform: translateY(-85%);
  opacity: 0;
  transition: transform 0.6s $transition-timing 0.2s, opacity 0.4s ease 0.1s;
}

.popup-content {
  width: 100%;
  overflow: visible;
  z-index: 2;
  transform: scaleY(0);
  transform-origin: bottom center;
  transition: transform 0.6s $transition-timing 0.2s;

  img {
    width: 100%;
    border-radius: 8px;
    height: auto;
    // object-fit: contain;
    pointer-events: none;
    display: block;
  }
}

.popup-message {
  width: 100%;
  border-radius: 8px;
          max-width: 100vw;

  overflow: hidden;
  z-index: 1;
  opacity: 0;
  transition: opacity 0.5s ease 0.4s, transform 0.6s $transition-timing 0.2s;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
          transform: translateX(100%);


  img {
    width: 100%;
    height: auto;
        max-width: 100vw;
    object-fit: contain;

    pointer-events: none;
    display: block;
  }
}

// Popup card cover needs different transform origin
.card-container.popup {
  overflow: visible;

  .card-inner {
    overflow: visible;
  }

  .card-cover {
    transform-origin: bottom center;
    transition: transform 0.6s $transition-timing, box-shadow 0.5s ease;
  }

  &.open {
    transform-style: flat;
  }
}

// Fold-down card cover needs top center transform origin
.card-container.fold-down {
  .card-cover {
    transform-origin: top center;
  }
}
